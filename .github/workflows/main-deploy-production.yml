name: Update App

on:
 push:
   branches: [main]

permissions:
  contents: read

jobs:
  deploy-app:
    runs-on: ubuntu-latest
    environment:
      name: production
    env:
      HEARTBEAT_TOKEN: ${{ secrets.HEARTBEAT_TOKEN }}
      LOG_DESTINATIONS: ${{ secrets.LOG_DESTINATIONS }}
      LOG_LEVEL: ${{ vars.LOG_LEVEL }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - name: Install doctl
        uses: digitalocean/action-doctl@135ac0aa0eed4437d547c6f12c364d3006b42824 # v2.5.1
        with:
          token: ${{ secrets.DIGITAL_OCEAN_ACCESS_TOKEN }}
      - name: Extend the doctl client with the serverless plugin
        run: doctl serverless install && doctl serverless connect
      - name: Deploy the app
        #run: doctl serverless deploy .
